<% content_for(:page_title) { ('Dashboard') } %>
<% content_for(:hero_image) { image_tag 'heros/dashboard.jpg' } %>

<div class="dashboard">

  <section class="avatar">
    <% if current_user.profile.avatar.present? %>
      <%= image_tag current_user.profile.avatar.url(:small), id: "person-icon" %>
    <% else %>
      <%= image_tag("person-icon.png", size: "200x200", alt: "person icon", id: "person-icon") %>
    <% end %>
    <%= image_tag("camera-icon.png", size: "35x35", alt: "camera icon", id: "camera-icon") %>
  </section>

  <div id="edit-avatar" hidden>
    <%= form_for current_user, url: profile_path do |f| %>
       <%= f.fields_for :profile, html: { multipart: true } do |p| %>
        <div>
          <%= p.file_field :avatar %>
        </div>
      <% end %>
      <%= f.submit id: 'update-avatar' %>
    <% end %>
  </div>

  <div class="dashboard-fields">

    <section>
      <h1 class="welcome">
        <% if current_user.profile.title.present? && current_user.profile.last_name.present? %>
          <%= "#{current_user.profile.greeting}, #{current_user.profile.title} #{current_user.profile.last_name}" %>!
        <% elsif current_user.profile.first_name.present? %>
          <%= "#{current_user.profile.greeting}, #{current_user.profile.first_name}" %>!
        <% else %>
          <%= "#{current_user.profile.greeting}!" %>
        <% end %>
        <%= image_tag("pencil-icon.png", size: "25x25",alt: "pencil icon", class: "pencil-icon", id: "pencil-name") %>
      </h1>
    </section>

    <section id="edit-name" class="edit-user-data" hidden>
      <%= form_for current_user, url: profile_path do |f| %>
         <%= f.fields_for :profile do |p| %>
          <div>
            <%= p.label :title %><br />
            <%= p.text_field :title %>
          </div>
          <div>
            <%= p.label :first_name %><br />
            <%= p.text_field :first_name %>
          </div>
          <div>
            <%= p.label :last_name %><br />
            <%= p.text_field :last_name %>
          </div>
         <% end %>
         <div class="actions">
           <%= f.submit "Update" %>
         </div>
      <% end %>
    </section>

    <section>
      <h1>account settings:</h1>
      <section>
        <h4>
          classroom data
          <%= image_tag("pencil-icon.png", size: "20x20",alt: "pencil icon", class: "pencil-icon", id: "pencil-classroom") %>
        </h4>
        <section id="classroom-data">
          <% current_user.profile.classroom_fields.each do |classroom_field| %>
            <% if current_user.profile[classroom_field].present? %>
              <p><%= "#{classroom_field.capitalize}: #{current_user.profile[classroom_field]}" %></p>
            <% end %>
          <% end %>
        </section>
      </section>

      <section id="edit-classroom-data" class="edit-user-data" hidden>
        <%= form_for current_user, url: profile_path do |f| %>
           <%= f.fields_for :profile do |p| %>
            <div>
              <%= p.label :school %><br />
              <%= p.text_field :school %>
            </div>
            <div>
              <%= p.label :city %><br />
              <%= p.text_field :city %>
            </div>
            <div>
              <%= p.label :state %><br />
              <%= p.text_field :state %>
            </div>
            <div>
              <%= p.label :country %><br />
              <%= p.text_field :country %>
            </div>
            <div>
              <%= p.label :occupation %><br />
              <%= p.text_field :occupation %>
            </div>
            <div>
              <%= p.label "Grades Taught" %><br />
              <%= p.text_field :grades %>
            </div>
           <% end %>
           <div class="actions">
             <%= f.submit "Update" %>
           </div>
        <% end %>
      </section>

      <section id="contact-preferences">
        <h4>
          contact preferences
          <%= image_tag("pencil-icon.png", size: "20x20",alt: "pencil icon", class: "pencil-icon", id: "pencil-email") %>
        </h4>
        <div id="email-data">
          <p><%= current_user.email %></p>
        </div>
      </section>

      <section id="edit-email" class="edit-user-data" hidden>
        <%= form_for current_user do |f| %>
          <div class="field">
            <%= f.label :email %><br />
            <%= f.email_field :email, placeholder: current_user.email %>
          </div>

          <div class="actions">
            <%= f.submit "Update" %>
          </div>
        <% end %>
      </section>

      <section id="change-password">
        <h4>
          change password
          <%= image_tag("pencil-icon.png", size: "20x20",alt: "pencil icon", class: "pencil-icon", id: "pencil-password") %>
        </h4>
      </section>

      <section id="edit-password" class="edit-user-data" hidden>
        <%= form_for current_user do |f| %>

          <div class="field">
            <%= f.label :password %> <i>(leave blank if you don't want to change it)</i><br />
            <%= f.password_field :password, autocomplete: "off" %>
          </div>

          <div class="field">
            <%= f.label :password_confirmation %><br />
            <%= f.password_field :password_confirmation, autocomplete: "off" %>
          </div>

          <div class="actions">
            <%= f.submit "Update" %>
          </div>
        <% end %>
      </section>

    </section>

    <section>
      <h1>artroom:</h1>
      <div>
        <h4><span class="glyphicon glyphicon-star"  aria-hidden="true"></span>favorite projects</h4>
      </div>
      <% current_user.favorites.each do |favorite| %>
        <div style="display:inline-block;margin-left:10px;" class="favorite-in-dashboard">
          <a href="/lower/projects/<%= favorite.slug %>">
          <%= image_tag(favorite.project_set.project_image, size: "100x100") %>
          <p class="favorite-project-title"><%= favorite.title %></p>
          </a>
        </div>
        <% end %>
    </section>

    <div id="logout-button" class="btn">
      <%= link_to('Logout', destroy_user_session_path, :method => :delete) %>
    </div>

  </div>

</div>
